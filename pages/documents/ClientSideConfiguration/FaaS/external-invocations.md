---
pagename: External Invocations
keywords:
sitesection: Documents
categoryname: "Client Side Configuration"
documentname: Function as a Service
permalink: function-as-a-service-external-invocations.html
indicator: both
---

To provide brands the possibility to call their FaaS functions from outside of LivePerson's platform, we provide an API for External Invocation. With this API they can call their functions externally, secured by OAuth2.

Further information about OAuth2 and how we use it:

* OAuth2 introduction video: [link](https://www.youtube.com/watch?v=CPbvxxslDTU)

* Official Liveperson OAuth2 flow documentation: [link](authorizing-liveengage-applications-overview.html)

### Prerequisites for using external invocations:

* Execute the **App Installation** process in order to generate a `client-id` and `client-secret` for the oAuth2.0 flow. This can be done by your LivePerson account team so you should contact them for more assistance (you can also see [this](https://developers.liveperson.com/guides-le-applications-installing.html) guide for more detailed information).

Once you have secured your `client-id` and `client-secret`, and depending on your account, you can use the following hosts for external invocations (the base domain is: `faasGW`):

* **APAC**: [sy.faasgw.liveperson.net](http://sy.faasgw.liveperson.net/)

* **EMEA**: [lo.faasgw.liveperson.net](http://lo.faasgw.liveperson.net/)

* **US**: [va.faasgw.liveperson.net](http://va.faasgw.liveperson.net/)

However, instead of hardcoding the domain, it is recommended to use the [LivePerson Domain API](https://developers.liveperson.com/agent-domain-domain-api.html) to retrieve this information by providing the service name `faasGW` and retrieving the domain **dynamically**.

### Retrieve the domain of the oAuth server.

You'll also need to pass your `client-id` and `client-secret` to one of our oAuth servers for authentication. Depending on your account, you can use the following oAuth servers (the base domain is: `sentinel`):

* **APAC:** sy.sentinel.liveperson.net

* **EMEA:** lo.sentinel.liveperson.net

* **US:** va.sentinel.liveperson.net

However, instead of hardcoding the oAuth server, it is recommended to use the [LivePerson Domain API](https://developers.liveperson.com/agent-domain-domain-api.html) to retrieve this information by providing the service name `sentinel` and retrieving the host address **dynamically**.

### Get the **lambda UUID** from FaaS that should be invoked by the external invocation

Before starting this step, you will need an **oauth2 token** generated by this user before the FaaS lambda invocation (refer to [this](https://developers.liveperson.com/authorizing-liveengage-applications-overview.html) guide for more information on how to generate this token).

Please note that an access token is valid for 8 hours only. Its validity can be extended by calling a refresh endpoint. In order to refresh an existing access token, the application should use a refresh request as mentioned [here](https://developers.liveperson.com/authorizing-liveengage-applications-methods-refresh-request.html). It is recommended that the refresh request be made every 30 minutes to ensure that the access token does not expire.

Here is an example-app for executing the OAuth 2 flow: [link](https://www.google.com/url?q=https://github.com/LivePersonInc/sample-app-authorization&sa=D&ust=1553728159528000&usg=AFQjCNE_pGdbrcvT8_h1R5agIsQE3ySGMw). If you use [Postman](https://www.getpostman.com/) you can use this template to retrieve your token ([Postman Collection](https://drive.google.com/a/liveperson.com/file/d/1oMcXM3wH4toUWxn5mEu_uLz2adbeRZLi/view?usp=sharing)):

1. In your request-tab click on **Authorization**

2. Select type OAuth 2.0

3. Click on **Get New Access Token**

4. In the appearing dialog fill out the form:

    1. **Token Name**: how you want the token to be named

    2. **Grant Type**: **Authorization Code**

    3. **Callback URL**: the redirect-uri you set in the JSON of the App Installation ([http://localhost/callback](http://localhost/callback))

    4. **Auth URL**: https://va-a.sentinel.liveperson.net/sentinel/api/account/2065377/authorize?v=1.0

    5. **Access Token URL**: https://va-a.sentinel.liveperson.net/sentinel/api/account/2065377/token?v=2.0

    6. **Client ID**: the generated **client_id** of your App Installation

    7. **Client Secret**: the generated **client_secret** of your App Installation

    8. **Client Authentication**: **Send client credentials in Body**

5. Click on **Request Token**

6. Now you need to login with the user you created with the permission **FaaS Invocation** - the generated token will have the same permissions as the user you used for login

7. In this dialog you can see your generated **Access Token** that you can use to perform the invocation

2. This is the **refresh_token** you need for refreshing your Access Token

3. If you click **Use Token**, the Access Token will be used for your Postman call

#### Steps for calling the invocation API:

1. All prerequisites have been finished

    * **AccountId** is available.

    * **LambdaUUID** is available.

    * **UserId** is available of the system-user invoking FaaS.

    * **Username + password** of the system-user invoking FaaS.

    * **Client-Id + Client-Secret** is available after App-Installation.

    * **Callback-URL** of oAuth flow is available and accessible.

    * **Sentinel + FaaS - domain** is available.

In next step we will use a Postman-Collection that **first** uses the oAuth2.0 flow to retrieve a valid **access-token** and **second** will execute the FaaS **invocation** providing the retrieved access-token within the headers.

1. Download [Postman Collection](https://drive.google.com/a/liveperson.com/file/d/1oMcXM3wH4toUWxn5mEu_uLz2adbeRZLi/view?usp=sharing)

2. Import collection into your local postman

3. The collection contains one POST-request.

4. The main call is to our invocation endpoint and has the following structure:

`https://{faasGW_domain}/api/account/{accountId}/lambdas/{lambdaUUID}/invoke?v=1&userId={userId}`

Parameters of the URL:

* **faasGW_domain**: domain used for FaaS invocation

* **accountId**: your accountId

* **lambdaUUID**: uuid for the lambda

* **userId**: user-Id from user that created the Oauth2 token.

with body (content type: application/json):

```json
{
	"timestamp": 0,
	"headers": [
		{
			"key": "string",
			"value": "string"
		}
	],
	"payload": {}
}
```

5. The body is similar to the values sent via the FaaS invocation UI. Additionally, each invocation needs to provide a timestamp in unix-epoch time format.

6. However, before the main call can be executed we need to retrieve the access-token. This is done via the oAuth host. Therefore the following configuration needs to be done in Postman. Please refer to [this](https://developers.liveperson.com/authorizing-liveengage-applications-overview.html) guide, for deeper insights about how the oAuth host and its APIs work.

    * In your request-tab click on **Authorization**

    * Select type OAuth 2.0

    * Click on **Get New Access Token**

    * In the appearing dialog fill out the form and click request token:

        1. **Token Name**: how you want the token to be named

        2. **Grant Type**: **Authorization Code**

        3. **Callback URL**: the redirect-uri you set in the JSON of the App Installation ([http://localhost/callback](http://localhost/callback))

        4. **Auth URL**: https://va-a.sentinel.liveperson.net/sentinel/api/account/2065377/authorize?v=1.0

        5. **Access Token URL**: https://va-a.sentinel.liveperson.net/sentinel/api/account/2065377/token?v=2.0

        6. **Client ID**: the generated **client_id** of your App Installation

        7. **Client Secret**: the generated **client_secret** of your App Installation

        8. **Client Authentication**: **Send client credentials in Body!!!**

    * Now the oAuth2.0 flow is triggered and you will first be forwarded to the LE-Login page. There you need to provide the credentials of the system-user that will be used for invocation.

    * After you logged in with valid credentials you should see the following screen.

    * You got a access-token + refresh-token. The access-token will be sent with every FaaS invocation. The refresh-token needs to be used in order to get a next access-token after the TTL of the current access-token is reached.

        * An access token is valid for 8 hours only. Its validity can be extended by calling a refresh endpoint. In order to refresh an existing access token, the application should use a refresh request as mentioned [here](https://developers.liveperson.com/authorizing-liveengage-applications-methods-refresh-request.html). It is recommended that the refresh request is made every 30 minutes to ensure that the access token does not expire.

    * If you click **Use Token**, the access-token will be used for your Postman call.

**Hint:** You can also use [this](https://github.com/LivePersonInc/sample-app-authorization) sample app, in case the Postman oAuth2.0 does not work for you. Please make sure that the callback-url in the App-Installation is set to **http://localhost:3000/callback**.

7. Now the main call can be executed with the retrieved access-token

Example invocation in Postman:

* Fill out the required Post-body

* Press **Send**

* As a response you should see the result of your lambda
