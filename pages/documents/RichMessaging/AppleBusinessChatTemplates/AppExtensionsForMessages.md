---
pagename: App Extensions Template
Keywords:
sitesection: Documents
categoryname: "Rich Messaging"
documentname: Apple Business Chat Templates
permalink: apple-business-chat-templates-app-extensions-template.html
indicator: messaging
---

### Overview

The App Extensions Template for App Business Chat allows you to send an iOS mini app to the consumer device. This mini app can allow for a wide range of interactivity without requiring the consumer to leave the conversation.

### Body

The structured content body will allow you to define the layout of the bubble representation in the agent workspace transcript as structured content basic elements.

Please note that the structured content body layout will not be represented on the consumer device. The body will help the brands create a visual representation in LiveEngage of the iMessage bubble that was sent (for conversational context, transcript and historic records, as well as ease of use for agents).

In order to allow brands to report on the number of times an iMessage app was sent from an agent widget during a conversation, make sure to add a unified indication in the structured content body for each type of iMessage app the brand uses. This will allow you to then track how many times a specific iMessage app was sent via a transcript search.

For the structured content body fields descriptions and different layout options please refer to [Getting Started with Structured Content.](getting-started-with-rich-messaging-introduction.html)

### Metadata

The structured content metadata will allow you to define which app extension should be linked to the consumer and which custom, contextual data to pass into the extension when it loads.

Using Metadata, you can also set and control the visual appearance of the received bubble layout for the app extension.


#### Metadata Properties

<table>
  <thead>
    <td>Property Name</td>
    <td>Description</td>
    <td>Type</td>
    <td>Required</td>
  </thead>
  <tbody>
  <tr>
    <td>type</td>
    <td>Type of metadata.                              Must be BusinessChatCustomMessage </td>
    <td>Enum</td>
    <td>Y</td>
  </tr>
  <tr>
    <td>appId</td>
    <td>The App Store identifier of the custom                                 Messages framework extension </td>
    <td>Integer</td>
    <td>N</td>
  </tr>
  <tr>
    <td>appName</td>
    <td>The name of the custom Messages                               framework extension.</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>bid</td>
    <td>Identifies the Messages framework extension that the customer interacts with while using Messages. It is composed along with the extension bundleID, and teamID </td>
    <td>String</td>
    <td>Y</td>
  </tr>
  <tr>
    <td>sessionIdentifier</td>
    <td>Valid UUID string, generated by the brand. This could represent a message or a group or messages that identifies the session or transaction</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>useLiveLayout</td>
    <td>A flag that determines if Live Layout is enabled. The default is false.</td>
    <td>Boolean</td>
    <td>N</td>
  </tr>
  <tr>
    <td>receivedMessage</td>
    <td>Bubble displayed when interactive message is received and LiveLayout is set to false</td>
    <td>Object</td>
    <td>Y</td>
  </tr>
  <tr>
    <td>URL</td>
    <td>The URL to the data that is sent to the Messages framework extension. Should be sent encoded</td>
    <td>String</td>
    <td>Y</td>
  </tr>
  </tbody>
</table>


#### Metadata Received Message Properties

<table>
  <thead>
    <td>Property Name</td>
    <td>Description</td>
    <td>Type</td>
    <td>Required</td>
  </thead>
  <tbody>
  <tr>
    <td>title</td>
    <td>The title of the bubble</td>
    <td>String</td>
    <td>Y</td>
  </tr>
  <tr>
    <td>subtitle</td>
    <td>Subtitle to be displayed under title in bubble </td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>secondarySubtitle</td>
    <td>Title that is aligned right</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>tertiarySubtitle</td>
    <td>Subtitle that is aligned right</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>imageTitle</td>
    <td>The title of the image attachment.</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>image Subtitle</td>
    <td>The subtitle of the image attachment.</td>
    <td>String</td>
    <td>N</td>
  </tr>
  <tr>
    <td>imageURL</td>
    <td>Image to be placed in the iMessage app bubble layout. Will be presented when LiveLayout is disabled or when consumer does not have the brand app installed on iPhone/latest version is not updated with app extension</td>
    <td>String</td>
    <td>N</td>
  </tr>
  </tbody>
</table>


#### Example Metadata Template

```json
[{
    "type": "BusinessChatCustomMessage",
    "appId": 1234,
    "appName": "productselection",
    "bid": "com.apple.messages.MSMessageExtensionBalloonPlugin:yourTEAMID:yourextensionbundleID",
    "sessionIdentifier": "",
    "useLiveLayout": true,
    "receivedMessage": {
      "imageURL":"https://s3.amazonaws.com/lp-mobile-apps/WelcomeMessagePOC/Welcome-02-web-version.jpg",
      "title": "Welcome to Icon Brand!",
      "style": "icon",
      "subtitle": "Lots to accomplish together.",
      "secondarySubtitle": "",
      "tertiarySubtitle": "",
      "imageTitle": "",
      "imageSubtitle": ""
    },
    "URL": "?data={'customData': ...data value goes here }”
}]
```

The value of the “customData” key in the URL property is the brand’s data JSON. The URL field should be URI encoded.

**Pre encoded custom data example template**

```json
{
  "customData":{
    "messageDescriptors": {
      "timestamp": "2018-01-02T08:15:30-05:00",
      "authenticationPending": false
    },
    "stateDescriptors": {
      "state": "initial",
      "isDirtyPending": false,
      "userLocation": { "lat":"12.7898789", "lon":"387.45f4545" }
    },
    "interactionDescriptors": {
      "isSendAsText": true,
      "isDirectSend": true,
      "isMultiSelection": true
    },
    "transactionDescriptors": {
      "selectedItemIdx": [],
      "postAPI": "https://productselection.com/api/productstatus"
    },
    "endPointDescriptors": {
      "modelApiUrl": "https://s3.amazonaws.com/lp-mobile-apps/ABCBestPractice/tableModel.txt"
    }
  }
}
```

**Note:**

* General recommendation for the URL field is to use an URI encoded data object which will represent the URL 

* Please note! The URL should be lean as possible as described in the example above, and should not replace or attempt to act as the app model. 

* The AppID, Extension Bundle ID and Team ID (which are part of the Bid field) must be part of the SC metadata JSON! Without them your iMessage app will not be delivered to the consumer. 

* RecivedBubble image URL - If consumer does not have the extension installed on device, or if consumer has the extension installed but does not use LiveLayout (set to false) then the recivedBubble will default to the imageURL set in the recievedBubble object.  If imageURL was not added to the SC schema defined, the layout view will be an empty frame! Please note to the brands to always include an imageURL! 

* ImageURL MUST be whitelisted - to whitelist images for Structured Content go to: Site Setting -> messaging.rich.content.valid.urls - and add the image URLs. 

* SessionIdentifier - Any interactive message that is sent to ABC has a UUID - either the brand can set it through this field, or if not set Apple will generate a UUID for the interactive message. We recommend the brand setting UUID for each interactive message sent from the agent, in order to maintain referencing and correlating between interactions, for grouping messages,  funnel tags and more. 

* Images placed in the image used in imageURL field should be whitelisted in account Houston - Site Setting messaging.rich.content.valid.urls

* When no app exists on the receiving device that can consume the message, if this URL is a HTTP(S) url, it will be loaded in a web browser. Please be aware of the experience when creating the URLs for the brand/alert the brands on this experience 
The root object of the JSON in the URL field should be dictionary (key:value) and not an array ( {} and not [] ).

**Limitations:**

* URL characters limit is 64bit - brands should create URLs to accommodate this limitation (A option to overcome this limitation is for the brand to a static JSON in a S3 type environment which they can call in the message URL)

* UMS character limit - The UMS limitation is currently 5000 characters, brands should recognize this limitation and build URLs to accommodate this limitation


#### Reply Message

The structured content reply bubble will enable you to create an end to end conversational experience with app extensions - making sure agent or bots can view the received bubble sent to the consumer, as well as the associated reply bubble initiated by the consumer. The reply bubble will be defined as a textual representation.

The new property will allow the agent/bot to view the textual representation of the reply bubble, and will be added to the MSmessage "url" property. The URL schema can be defined both on the structure content outgoing message from the agent/bot, or only on the replied custom bubble from the consumer. Below you will find the URL scheme for the reply bubble:

**Encoded URL schema:**

`?data=%7B%0A%20%20%20%20%22lpData%3CBRAND_ID%3E%22%3A%20%7B%0A%20%20%20%20%20%20%22interactive%22%20%3A%20%7B%0A%20%20%20%20%20%20%20%20%22response%22%20%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%22text%22%3A%20%22%3CYOUR_CUSTOM_TEXT%3E%22%20%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%7D`

**Decoded query params:**

```json
{
    "lpData": {
      "interactive" : {
        "response" : {
          "text": "<YOUR_CUSTOM_TEXT>"
        }
      }
    }
}
```

### Some Notes About Custom iMessage App Support via Structured Content:

1. General recommendation for the URL field is to use an encoded data object which will represent the URL

3. Custom iMessage app response bubble - the connector currently does not capture reply bubble response from the consumer to the iMessage app. However, the transaction that occurred in the iMessage app by the consumer can be captured by the brand and updated in the Agent Widget SDK. (The response will be captured in the LE transcript line in future version).

4. Reporting - in order to allow brands to report on the number of times an iMessage app was sent from an agent widget during a conversation, make sure to add a unified indication in the structured content message body for each type of iMessage app the brand uses. This will allow the brand to then track how many times a specific iMessage app was sent via a transcript search.
